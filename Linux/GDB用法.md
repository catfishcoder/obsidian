# gdb使用指南

## 0.开始
- gdb全称“GNU symbolic debugger”，诞生于GUN计划，是linux下常用的**程序调试器**。常用于调试C/C++.
- 在编译时使用`g++ -g 0.cpp`生成含有调试信息的可执行文件
- 启动gdb：`gdb ./a.out -q`
	- 使用-q/--quite/--slient 屏蔽gdb启动时的免责条款

## 1.gdb常用调试指令
| 调试指令 | 作用 |
|---------|-------|
|b(break) 行号|在源代码指定的某一行设置断点，其中行号用于指定具体打断点的位置。|
|r(run)|执行被调试的程序，其会自动在第一个断点处暂停执行。|
|n(next)|令程序一行代码一行代码的执行。|
|p(print) 变量名|打印指定变量的值|
|l（list）行号/函数名|显示指定行或函数附近源代码，默认从第一行开始|
|q（quit）|终止调试。|
|s(start)|执行程序至主函数的位置，然后使用continue命令继续执行|

## 2.如何传递参数
> 如果程序需要参数，可以用以下方法为gdb指定的目标程序传递参数
1. 启动 GDB 调试器时，可以在指定目标调试程序的同时，使用 `--args` 选项指定需要传递给该程序的数据。
	`$ gdb --args main.exe a.txt`
2.  GDB 调试器启动后，可以借助 set args 命令指定目标调试程序启动所需要的数据。
	`(gdb) set args a.txt`
3. 除此之外，还可以使用 run 或者 start 启动目标程序时，指定其所需要的数据。
	```C++
	(gdb) run a.txt
	(gdb) start a.txt
	```

## 3.设置断点
>默认情况下，**程序不会进入调试模式，代码会瞬间从开头执行到末尾。** 要想观察程序运行的内部细节，可以借助 GDB 调试器在程序中的某个地方**设置断点**，这样当程序执行到这个地方时就会停下来。
### 1.使用break设置断点
使用break设置断点一共有两种格式
```C++
(gdb) break location      // b 位置
(gdb) break location if cond   // b 表达式
```
- 第一种格式中location表示断点所在行号
- 第二种格式中cond是一个表达式，当程序指定到 location 位置时进行判断，如果条件为真就在该位置暂停，否则程序继续执行
### 2.使用tbreak设置断点
tbreak 命令可以看到是 break 命令的另一个版本，tbreak 和 break 命令的用法和功能都非常相似，唯一的不同在于，**使用 tbreak 命令打的断点仅会作用 1 次，即使程序暂停之后，该断点就会自动消失。**
### 3. 使用rbreak设置断点
break 和 tbreak 命令不同，**rbreak 命令的作用对象是 C、C++ 程序中的函数**，它会在指定函数的开头位置打断点。
`(gdb) tbreak 表达式		//例如(gdb) rbreak func `


## 4.变量操作
### 1.监控变量
GDB 调试器支持在程序中打 3 种断点，分别为**普通断点、观察断点和捕捉断点**。其中 break 命令打的就是普通断点，而 watch 命令打的为观察断点。
#### 0. 三种断点的区别
>**普通断点作用于程序中的某一行**，当程序运行至此行时停止执行，**观察断点作用于某一变量或表达式**，当该变量（表达式）的值发生改变时，程序暂停。而捕捉断点的作用是，**监控程序中某一事件的发生**，例如程序发生某种异常时、某一动态库被加载时等等，一旦目标时间发生，则程序停止执行。

#### 1.建立观察断点
```C++
(gdb) watch cond 	//conde 指的就是要监控的变量或表达式
```
watch 命令的功能是：**只有当被监控变量（表达式）的值发生改变，程序才会停止运行。**

#### 2.建立捕获断点
略
### 2. 查看变量
>对于**在调试期间查看某个变量或表达式的值**，GDB 调试器提供有 2 种方法，即使用 print 命令或者 display 命令。
#### print指令
- 可以缩写为p，常用语法如下
```C++
(gdb) print num		//参数 num 用来代指要查看或者修改的目标变量或者表达式
(gdb) p num
```

- 完整语法如下：`(gdb) print [options --] [/fmt] expr`
	- options：表示该命令所支持的选项，这些选项可以控制 print 命令输出指定内容的变量或者表达式的值；
	- fmt：指定输出变量或表达式值时所采用的格式；
	- expr：指定要查看的变量或表达式。

#### display指令
和 print 命令一样，display 命令也用于调试阶段查看某个变量或表达式的值，它们的区别是，使用 display 命令查看变量或表达式的值，**每当程序暂停执行时，GDB 调试器都会自动帮我们打印出来**，而 print 命令则不会。
```C++
(gdb) display expr			//expr 表示要查看的目标变量或表达式
(gdb) display/fmt expr		//参数 fmt 用于指定输出变量或表达式的格式
```

==option参数详情==
[![LG8tXS.md.png](https://s6.jpg.cm/2021/11/24/LG8tXS.md.png)](https://imagelol.com/image/LG8tXS)
==fmt参数详情==
[![LG8WCC.png](https://s6.jpg.cm/2021/11/24/LG8WCC.png)](https://imagelol.com/image/LG8WCC)
